@model Governança_de_TI.Models.EquipamentoModel

<!-- ===================== FORMULÁRIO DE CRIAÇÃO ===================== -->
<form id="formCriarEquipamento"
      asp-action="Criar"
      method="post"
      enctype="multipart/form-data"
      data-ajax="true"
      class="p-3">

    @Html.AntiForgeryToken()
    <div asp-validation-summary="All" class="text-danger small mb-3"></div>

    <div class="row g-3">

        <!-- COLUNA ESQUERDA -->
        <div class="col-md-7">

            <div class="mb-3">
                <label asp-for="Descricao" class="form-label text-muted small">
                    <i class="bi bi-cpu me-1"></i>Descrição do Equipamento
                </label>
                <input asp-for="Descricao" class="form-control shadow-sm" placeholder="Notebook Dell Inspiron 15" required />
            </div>

            <!-- TIPO DE EQUIPAMENTO -->
            <div class="mb-3">
                <label asp-for="TipoEquipamentoId" class="form-label text-muted small">
                    <i class="bi bi-tags me-1"></i>Tipo de Equipamento
                </label>
                <div class="input-group">
                    <select asp-for="TipoEquipamentoId"
                            asp-items="ViewBag.TipoEquipamentoId"
                            class="form-select shadow-sm"
                            id="TipoEquipamentoId"
                            required>
                    </select>

                    <!-- BOTÃO ABRIR MODAL (AGORA CORRIGIDO) -->
                    <button type="button"
                            class="btn btn-outline-secondary"
                            onclick="abrirModalCriarTipo(this)">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 mb-3">
                    <label asp-for="Serie" class="form-label text-muted small">Série</label>
                    <input asp-for="Serie" class="form-control shadow-sm" />
                </div>
                <div class="col-sm-6 mb-3">
                    <label asp-for="Modelo" class="form-label text-muted small">Modelo</label>
                    <input asp-for="Modelo" class="form-control shadow-sm" />
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 mb-3">
                    <label asp-for="DataCompra" class="form-label text-muted small">Data de Compra</label>
                    <input asp-for="DataCompra" class="form-control shadow-sm" type="date" />
                </div>
                <div class="col-sm-6 mb-3">
                    <label asp-for="VidaUtilAnos" class="form-label text-muted small">Vida Útil (Anos)</label>
                    <input asp-for="VidaUtilAnos" class="form-control shadow-sm" type="number" min="1" />
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="Status" class="form-label text-muted small">Status</label>
                <select asp-for="Status" class="form-select shadow-sm" required>
                    <option value="">Selecione...</option>
                    <option>Ativo</option>
                    <option>Em Manutenção</option>
                    <option>Descartado</option>
                </select>
            </div>

            <div class="row">
                <div class="col-sm-6 mb-3">
                    <label asp-for="FrequenciaManutencao" class="form-label text-muted small">Frequência Manutenção</label>
                    <select asp-for="FrequenciaManutencao" class="form-select shadow-sm" required>
                        <option value="">Nenhuma</option>
                        <option>Mensal</option>
                        <option>Trimestral</option>
                        <option>Anual</option>
                    </select>
                </div>

                <div class="col-sm-6 mb-3">
                    <label asp-for="DiasAlertaManutencao" class="form-label text-muted small">Dias de Alerta</label>
                    <input asp-for="DiasAlertaManutencao" class="form-control shadow-sm" type="number" min="1" />
                </div>
            </div>

            <div class="form-check form-switch mb-3">
                <input asp-for="EnviarEmailAlerta" class="form-check-input" type="checkbox" />
                <label asp-for="EnviarEmailAlerta" class="form-check-label small text-muted">
                    Enviar alerta por e-mail
                </label>
            </div>

            <div class="mb-3">
                <label asp-for="AnexoUpload" class="form-label text-muted small">Anexo</label>
                <input asp-for="AnexoUpload" class="form-control form-control-sm shadow-sm" type="file" />
            </div>
        </div>

        <!-- IMAGEM -->
        <div class="col-md-5 d-flex flex-column align-items-center">

            <label class="form-label text-muted small d-block mb-2 text-center">
                <i class="bi bi-image me-1"></i>Imagem
            </label>

            <div class="border rounded-4 bg-light p-2 shadow-sm d-flex align-items-center justify-content-center"
                 style="width: 180px; height: 180px; overflow: hidden;">

                <img id="previewImagemEquipamento"
                     src="/img/default-equip.png"
                     class="img-fluid rounded"
                     style="object-fit: cover; width: 100%; height: 100%;" />
            </div>

            <!-- Botão para alterar imagem -->
            <label for="inputImagemEquipamento" class="btn btn-outline-secondary w-100 mt-3">
                <i class="bi bi-upload me-1"></i> Escolher Imagem
            </label>

            <input asp-for="ImagemUpload"
                   type="file"
                   class="form-control form-control-sm mt-2"
                   id="inputImagemEquipamento"
                   accept="image/*" />
        </div>

    </div>

    <hr class="my-3" />

    <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary px-4" style="background:#8A2BE2;border-color:#8A2BE2;">
            <i class="bi bi-save me-2"></i>Salvar
        </button>
    </div>
</form>
<style>
    /* ========== MODAL "NOVO TIPO" COM TEMA TECHGREEN ========== */

    #modalCriarTipo .modal-dialog {
        max-width: 520px;
    }

    #modalCriarTipo .modal-content {
        background-color: var(--tg-card-bg, #ffffff);
        color: var(--tg-text, #222);
        border-radius: 16px;
        border: 1px solid var(--tg-border, #e5e5e5);
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
    }

    #modalCriarTipo .modal-header,
    #modalCriarTipo .modal-footer {
        background-color: var(--tg-header-bg, #f8f9fa);
        border-color: var(--tg-border, #e5e5e5);
    }

    #modalCriarTipo .modal-title {
        color: var(--tg-primary, #8A2BE2);
    }

    .btn-purple {
        background-color: #8A2BE2 !important;
        border: none !important;
    }

        .btn-purple:hover {
            background-color: #7621c4 !important;
        }

    /* só garante que fique acima da principal */
    #modalCriarTipo {
        z-index: 2050;
    }
</style>
<!-- ===================== CONTAINER DAS MODAIS DE TIPOS ===================== -->
<div id="areaModalTipos"></div>


<script>
    // ===================== PREVIEW IMAGEM =====================
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('inputImagemEquipamento');
        const preview = document.getElementById('previewImagemEquipamento');

        if (input && preview) {
            input.addEventListener('change', e => {
                const file = e.target.files[0];
                if (!file) {
                    preview.src = '/img/default-equip.png';
                    return;
                }
                const reader = new FileReader();
                reader.onload = ev => preview.src = ev.target.result;
                reader.readAsDataURL(file);
            });
        }
    });


</script>

