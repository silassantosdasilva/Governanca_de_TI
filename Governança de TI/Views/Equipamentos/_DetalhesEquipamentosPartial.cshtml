@model Governança_de_TI.Models.EquipamentoModel

<div class="p-4">

    <div class="row g-4">

        <!-- ==================== COLUNA ESQUERDA ==================== -->
        <div class="col-md-7">

            <!-- Descrição -->
            <div>
                <label class="form-label text-muted small">
                    <i class="bi bi-gear me-1"></i> Descrição do Equipamento
                </label>
                <input class="form-control shadow-sm" value="@Model.Descricao" readonly />
            </div>

            <!-- Tipo -->
            <div class="mt-3">
                <label class="form-label text-muted small">
                    <i class="bi bi-tags me-1"></i> Tipo de Equipamento
                </label>
                <input class="form-control shadow-sm"
                       value="@Model.TipoEquipamento?.Nome" readonly />
            </div>

            <!-- Série e Modelo -->
            <div class="row mt-3">
                <div class="col-sm-6">
                    <label class="form-label text-muted small">Série</label>
                    <input class="form-control shadow-sm" value="@Model.Serie" readonly />
                </div>

                <div class="col-sm-6">
                    <label class="form-label text-muted small">Modelo</label>
                    <input class="form-control shadow-sm" value="@Model.Modelo" readonly />
                </div>
            </div>

            <!-- Datas: Compra / Vida Útil -->
            <div class="row mt-3">
                <div class="col-sm-6">
                    <label class="form-label text-muted small">Data de Compra</label>
                    <input class="form-control shadow-sm"
                           value="@Model.DataCompra?.ToString("dd/MM/yyyy")" readonly />
                </div>

                <div class="col-sm-6">
                    <label class="form-label text-muted small">Vida Útil (Anos)</label>
                    <input class="form-control shadow-sm"
                           value="@Model.VidaUtilAnos" readonly />
                </div>
            </div>

            <!-- Status -->
            <div class="mt-3">
                <label class="form-label text-muted small">Status</label>
                <input class="form-control shadow-sm" value="@Model.Status" readonly />
            </div>

            <!-- Frequência -->
            <div class="mt-3">
                <label class="form-label text-muted small">Frequência de Manutenção</label>
                <input class="form-control shadow-sm"
                       value="@Model.FrequenciaManutencao" readonly />
            </div>

            <!-- Última Manutenção -->
            <div class="mt-3">
                <label class="form-label text-muted small">Última Manutenção</label>
                <input class="form-control shadow-sm"
                       value="@(Model.DataUltimaManutencao?.ToString("dd/MM/yyyy") ?? "N/A")" readonly />
            </div>

            <!-- Dias alerta / Checkbox -->
            <div class="row mt-3">
                <div class="col-sm-6">
                    <label class="form-label text-muted small">Dias de Alerta</label>
                    <input class="form-control shadow-sm"
                           value="@Model.DiasAlertaManutencao" readonly />
                </div>

                <div class="col-sm-6 d-flex align-items-center">
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox"
                               @(Model.EnviarEmailAlerta ? "checked" : "") disabled />
                        <label class="form-check-label text-muted small">
                            Enviar alerta por e-mail
                        </label>
                    </div>
                </div>
            </div>

        </div>

        <!-- ==================== COLUNA DIREITA (IMAGEM) ==================== -->
        <div class="col-md-5 text-center">

            <label class="form-label text-muted small d-block mb-2">
                <i class="bi bi-image me-1"></i> Imagem do Equipamento
            </label>

            <!-- Imagem -->
            <div class="border rounded-4 bg-light shadow-sm p-2 mx-auto"
                 style="width: 180px; height: 180px; overflow: hidden;">

                <img src="@(string.IsNullOrEmpty(Model.ImagemUrl)
                                                     ? Url.Content("~/img/default-equip.png")
                                                     : Url.Content("~" + Model.ImagemUrl))"
                     class="img-fluid rounded"
                     style="object-fit: cover; width:100%; height:100%;" />
            </div>

            <!-- Anexo -->
            <div class="mt-4">
                <label class="form-label text-muted small d-block">Anexo</label>

                @if (!string.IsNullOrEmpty(Model.AnexoUrl))
                {
                    <a href="@Url.Content("~" + Model.AnexoUrl)"
                       class="btn btn-outline-primary w-100"
                       target="_blank">
                        <i class="bi bi-download me-1"></i> Baixar Anexo
                    </a>
                }
                else
                {
                    <p class="text-muted small mt-1">Nenhum anexo disponível.</p>
                }
            </div>
        </div>
    </div>

    <hr class="my-4" />

    <!-- Botões -->
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i> Fechar
        </button>
    </div>

</div>


<script>

    $(document).on("click", ".btn-editar-equipamento-detalhes", function () {

        const id = $(this).data("id");
        const modal = bootstrap.Modal.getOrCreateInstance("#userModal");

        // Mostra loader
        $("#userModalLabel").text("Editar Equipamento");
        $("#userModal .modal-body").html(`
            <div class="text-center p-5">
                <div class="spinner-border text-primary"></div>
                <p class="mt-3 text-muted">Carregando...</p>
            </div>
        `);

        // Abrir modal imediatamente
        modal.show();

        // Configura botão salvar
        $("#btnConfirmarModalPrincipal")
            .attr("form", "formEditarEquipamento")
            .text("Salvar Alterações")
            .show()
            .prop("disabled", true);

        // Chama controller
        $.get("/Equipamentos/Editar/" + id)
            .done(function (data) {

                $("#userModal .modal-body")
                    .hide()
                    .html(data)
                    .fadeIn(200);

                $("#btnConfirmarModalPrincipal").prop("disabled", false);
            })
            .fail(function () {
                $("#userModal .modal-body").html("<div class='alert alert-danger'>Erro ao carregar.</div>");
                $("#btnConfirmarModalPrincipal").hide();
            });

    });


</script>
