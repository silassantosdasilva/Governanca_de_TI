@model Governança_de_TI.Models.EquipamentoModel

<div class="p-4">

    <form id="formEditarEquipamento"
          asp-action="Editar"
          method="post"
          enctype="multipart/form-data">

        @Html.AntiForgeryToken()

        <!-- Campos Hidden -->
        <input type="hidden" asp-for="CodigoItem" />
        <input type="hidden" asp-for="DataDeCadastro" />
        <input type="hidden" asp-for="ImagemUrl" />
        <input type="hidden" asp-for="AnexoUrl" />

        <div class="row g-4">

            <!-- ========================= COLUNA ESQUERDA ========================= -->
            <div class="col-md-7">

                <!-- Descrição -->
                <div>
                    <label asp-for="Descricao" class="form-label text-muted small">
                        <i class="bi bi-cpu me-1"></i> Descrição do Equipamento
                    </label>
                    <input asp-for="Descricao" class="form-control shadow-sm"
                           placeholder="Ex: Notebook Dell Inspiron 15"  />
                    <span asp-validation-for="Descricao" class="text-danger small"></span>
                </div>

                <!-- Tipo -->
                <div class="mt-3">
                    <label asp-for="TipoEquipamentoId" class="form-label text-muted small">
                        <i class="bi bi-tags me-1"></i> Tipo de Equipamento
                    </label>

                    <div class="input-group">
                        <select asp-for="TipoEquipamentoId"
                                asp-items="ViewBag.TipoEquipamentoId"
                                class="form-select shadow-sm">
                            <option value="">Selecione...</option>
                        </select>

                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-toggle="modal"
                                data-bs-target="#modalGerenciarTipos">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Série / Modelo -->
                <div class="row mt-3">
                    <div class="col-sm-6">
                        <label asp-for="Serie" class="form-label text-muted small">Série</label>
                        <input asp-for="Serie" class="form-control shadow-sm" placeholder="Número de série" />
                    </div>

                    <div class="col-sm-6">
                        <label asp-for="Modelo" class="form-label text-muted small">Modelo</label>
                        <input asp-for="Modelo" class="form-control shadow-sm" placeholder="Modelo exato" />
                    </div>
                </div>

                <!-- Datas -->
                <div class="row mt-3">
                    <div class="col-sm-6">
                        <label asp-for="DataCompra" class="form-label text-muted small">Data de Compra</label>
                        <input asp-for="DataCompra" type="date" class="form-control shadow-sm" />
                    </div>

                    <div class="col-sm-6">
                        <label asp-for="VidaUtilFim" class="form-label text-muted small">Fim da Vida Útil</label>
                        <input asp-for="VidaUtilFim" type="date" class="form-control shadow-sm" />
                    </div>
                </div>

                <!-- Status -->
                <div class="mt-3">
                    <label asp-for="Status" class="form-label text-muted small">Status</label>
                    <select asp-for="Status" class="form-select shadow-sm">
                        <option value="">Selecione...</option>
                        <option>Ativo</option>
                        <option>Em Manutenção</option>
                        <option>Descartado</option>
                    </select>
                </div>

                <!-- Frequência -->
                <div class="mt-3">
                    <label asp-for="FrequenciaManutencao" class="form-label text-muted small">Frequência</label>
                    <select asp-for="FrequenciaManutencao" class="form-select shadow-sm">
                        <option>Nenhuma</option>
                        <option>Mensal</option>
                        <option>Trimestral</option>
                        <option>Anual</option>
                    </select>
                </div>

                <!-- Última manutenção -->
                <div class="mt-3">
                    <label asp-for="DataUltimaManutencao" class="form-label text-muted small">Última Manutenção</label>
                    <input asp-for="DataUltimaManutencao" type="date" class="form-control shadow-sm" />
                </div>

                <!-- Anexo -->
                <div class="mt-3">
                    <label asp-for="AnexoUpload" class="form-label text-muted small">Anexo</label>
                    <input asp-for="AnexoUpload" type="file" class="form-control form-control-sm shadow-sm" />
                </div>

                <!-- Dias alerta / Checkbox -->
                <div class="row mt-3">
                    <div class="col-sm-6">
                        <label asp-for="DiasAlertaManutencao" class="form-label text-muted small">
                            Dias de Alerta
                        </label>
                        <input asp-for="DiasAlertaManutencao" class="form-control shadow-sm" type="number" />
                    </div>

                    <div class="col-sm-6 d-flex align-items-center">
                        <div class="form-check mt-3">
                            <input asp-for="EnviarEmailAlerta" type="checkbox" class="form-check-input" />
                            <label asp-for="EnviarEmailAlerta" class="form-check-label text-muted small">
                                Enviar alerta por e-mail
                            </label>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ========================= COLUNA DIREITA (IMAGEM) ========================= -->
            <div class="col-md-5 text-center">

                <label class="form-label text-muted small d-block mb-2">
                    <i class="bi bi-image me-1"></i> Imagem do Equipamento
                </label>

                <div class="border rounded-4 bg-light p-2 shadow-sm mx-auto"
                     style="width: 180px; height: 180px; overflow: hidden;">

                    <img id="imagePreviewEditar"
                         src="@(string.IsNullOrEmpty(Model.ImagemUrl)
                                                         ? Url.Content("~/img/default-equip.png")
                                                         : Url.Content("~" + Model.ImagemUrl))"
                         class="img-fluid rounded"
                         style="object-fit: cover; width: 100%; height: 100%;" />
                </div>

                <!-- Botão alterar -->
                <label for="ImagemUpload" class="btn btn-outline-secondary w-100 mt-3">
                    <i class="bi bi-upload me-1"></i> Alterar Imagem
                </label>

                <input asp-for="ImagemUpload"
                       id="ImagemUpload"
                       type="file"
                       class="d-none"
                       accept="image/*" />

                <!-- Anexo atual -->
                @if (!string.IsNullOrEmpty(Model.AnexoUrl))
                {
                    <a href="@Url.Content("~" + Model.AnexoUrl)"
                       target="_blank"
                       class="btn btn-outline-primary mt-3 w-100">
                        <i class="bi bi-download me-1"></i> Baixar Anexo Atual
                    </a>
                }

            </div>

        </div>

        <hr class="my-4" />

        <!-- Botões -->
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
                <i class="bi bi-x-circle me-1"></i> Cancelar
            </button>

            <button type="submit"
                    class="btn btn-primary px-4"
                    style="background-color:#8A2BE2;border-color:#8A2BE2;">
                <i class="bi bi-save me-1"></i> Salvar Alterações
            </button>
        </div>

    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("ImagemUpload");
        const preview = document.getElementById("imagePreviewEditar");

        if (input && preview) {
            input.addEventListener("change", e => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = ev => preview.src = ev.target.result;
                reader.readAsDataURL(file);
            });
        }

        if (window.jQuery && $.validator && $.validator.unobtrusive) {
            $.validator.unobtrusive.parse("#formEditarEquipamento");
        }
    });
</script>
